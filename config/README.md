# Конфигурация базового промпта

## Архитектура промптов

Система промптов состоит из двух частей:

### 1. Базовый промпт (`base_prompt.txt`)
**Что это:** Общие правила поведения для ВСЕХ ботов на платформе.

**Где хранится:** `config/base_prompt.txt`

**Что содержит:**
- Как бот должен говорить (короткие фразы, разговорный стиль)
- Чего НЕ делать (канцелярит, длинные предложения)
- Общие правила общения

**Как изменить:**
1. Отредактируй файл `config/base_prompt.txt`
2. Перезапусти агента
3. Изменения применятся ко ВСЕМ ботам

**Переопределение через переменную окружения:**
```bash
# Использовать кастомный базовый промпт
export BASE_PROMPT_PATH=/path/to/custom_prompt.txt
```

### 2. Skillbase конфигурация (БД)
**Что это:** Специфика конкретного клиента/ниши.

**Где хранится:** PostgreSQL таблица `skillbases`, колонка `config` (JSONB)

**Что содержит:**
- Роль бота (администратор салона, менеджер по продажам)
- Стиль общения (дружелюбный, формальный)
- Факты о компании (часы работы, услуги)
- Задачи (этапы разговора, сбор данных)
- Правила безопасности (что не обсуждать)

**Как изменить:**
1. Через API: `PUT /api/skillbases/{id}`
2. Через админку (когда будет готова)
3. Изменения применяются только к конкретному Skillbase

## Итоговый промпт

Финальный system prompt = **Базовый промпт** + **Skillbase конфигурация**

```
# КТО ТЫ                          ← из base_prompt.txt
# КАК ГОВОРИТЬ                    ← из base_prompt.txt
# ЧЕГО НЕ ДЕЛАТЬ                  ← из base_prompt.txt

# ТВОЯ РОЛЬ                       ← из Skillbase.config.context.role
# О КОМПАНИИ                      ← из Skillbase.config.context.facts
# ТВОЯ ЗАДАЧА                     ← из Skillbase.config.flow
# ПРАВИЛА БЕЗОПАСНОСТИ            ← из Skillbase.config.context.safety_rules
# ЯЗЫК                            ← из base_prompt.txt
```

## Примеры использования

### Пример 1: Изменить базовый промпт для всех ботов
```bash
# Отредактировать файл
nano config/base_prompt.txt

# Добавить новое правило
# НОВОЕ ПРАВИЛО
- Всегда представляйся в начале разговора

# Перезапустить агента
systemctl restart new-voice-agent
```

### Пример 2: Создать Skillbase для салона красоты
```python
skillbase_config = {
    "context": {
        "role": "Администратор салона красоты",
        "style": "Дружелюбный и профессиональный",
        "facts": [
            "Мы работаем с 9:00 до 21:00",
            "У нас 5 мастеров",
            "Принимаем оплату картой и наличными"
        ],
        "safety_rules": [
            "Не обсуждай политику и религию",
            "Не давай медицинских советов"
        ]
    },
    "flow": {
        "type": "linear",
        "states": [
            "Приветствие",
            "Узнать имя клиента",
            "Узнать желаемую услугу",
            "Предложить время записи",
            "Подтвердить запись"
        ]
    },
    # ... остальная конфигурация
}
```

## Преимущества такой архитектуры

✅ **Централизованное управление:** Базовые правила в одном месте  
✅ **Гибкость:** Каждый клиент настраивает свою специфику  
✅ **Версионность:** Изменения базового промпта версионируются в Git  
✅ **A/B тестирование:** Можно тестировать разные базовые промпты через переменную окружения  
✅ **Безопасность:** Клиенты не могут изменить базовые правила платформы
