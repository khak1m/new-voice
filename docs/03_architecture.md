# Архитектура NEW-VOICE 2.0

## Общая схема

```
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│   Клиент    │────▶│ MTS Exolve  │────▶│   LiveKit   │
│  (Телефон)  │◀────│ (Телефония) │◀────│  (WebRTC)   │
└─────────────┘     └─────────────┘     └──────┬──────┘
                                               │
                                               ▼
                                    ┌─────────────────────┐
                                    │   Voice Agent       │
                                    │   (Python)          │
                                    └──────────┬──────────┘
                                               │
                    ┌──────────────────────────┼──────────────────────────┐
                    │                          │                          │
                    ▼                          ▼                          ▼
           ┌───────────────┐         ┌───────────────┐         ┌───────────────┐
           │   Deepgram    │         │   OpenAI      │         │   Cartesia    │
           │   (STT)       │         │   (LLM)       │         │   (TTS)       │
           └───────────────┘         └───────┬───────┘         └───────────────┘
                                             │
                                             ▼
                                    ┌───────────────┐
                                    │    Qdrant     │
                                    │    (RAG)      │
                                    └───────────────┘
```

## Поток данных

1. **Входящий звонок** → MTS Exolve принимает звонок
2. **Аудио стрим** → LiveKit передаёт аудио агенту
3. **STT** → Deepgram конвертирует речь в текст
4. **RAG** → Qdrant ищет релевантный контекст
5. **LLM** → OpenAI генерирует ответ
6. **TTS** → Cartesia озвучивает ответ
7. **Ответ** → LiveKit отправляет аудио клиенту

## Компоненты

### Voice Agent (`src/agent/`)

Основной модуль, который:
- Подключается к LiveKit
- Обрабатывает аудио поток
- Координирует STT → LLM → TTS

### RAG System (`src/rag/`)

- Загрузка документов компании
- Chunking и эмбеддинги
- Поиск по векторной базе

### API (`src/api/`)

- REST API для управления
- Загрузка документов
- Настройка промптов
- Просмотр логов

### Telephony (`src/telephony/`)

- Интеграция с MTS Exolve
- Обработка входящих/исходящих звонков
- SIP → LiveKit bridge

## База данных

### Qdrant (векторы)
- Эмбеддинги документов
- Быстрый семантический поиск

### Supabase (данные)
- Записи разговоров
- Логи действий
- Настройки ботов
- CRM данные
